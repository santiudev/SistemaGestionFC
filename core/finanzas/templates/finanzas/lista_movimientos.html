{% extends 'base.html' %}
{% load static %}
{% block content %}
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Movimientos</title>
    <link href="{% static 'css/finanzas.css' %}" rel="stylesheet">
    <script src="{% static 'js/finanzas.js' %}" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
</head>
<body>
    <div class="container-fluid mt-4">
        <h2 class="text-center">Lista de Movimientos</h2>
        <div class="d-flex justify-content-between align-items-center mb-3">
            <!-- Botón para exportar a Excel -->
            <div class="text-end mb-3">
                <button id="exportarExcel" class="btn btn-success btn-sm">Exportar a Excel</button>
            </div>
            <div class="input-group w-25">
                <input type="text" id="filtroTabla" class="form-control" placeholder="Buscar" onkeyup="filtrarTabla()">
                <button class="btn  " type="button" id="clearButton" onclick="limpiarBusqueda()">
                    <i class="fas fa-times"></i> <!-- Ícono de Bootstrap para "clear" -->
                </button>
            </div>
            
        </div>
        

        <div class="table-responsive">
            <table id="tablaMovimientos" class="table table-hover my-0 w-100 custom-table">
                <thead class="table-light">
                    <tr>
                        <th style="width: 7%; position: relative;">
                            Fecha
                            <button class="btn btn-sm filter-btn" onclick="mostrarFiltroPopup(event, 'filtroFecha')" style="border: none;" data-column="fecha">
                                <i class="fas fa-filter text-secondary"></i> <!-- Cambiar a negro cuando esté activo -->
                            </button>
                            <div id="filtroFecha" class="filter-popup d-none">
                                <input type="date" class="form-control" id="fechaInicio" placeholder="Desde">
                                <input type="date" class="form-control mt-2" id="fechaFin" placeholder="Hasta">
                                <button class="btn btn-primary mt-2" onclick="filtrarPorRangoFechas()">Buscar</button> <!-- Botón de búsqueda -->
                            </div>
                        </th>
                        <th style="width: 8%; position: relative;">
                            Tipo
                            <button class="btn btn-sm filter-btn" onclick="mostrarFiltroPopup(event, 'filtroTipo')" style="border: none;" data-column="tipo">
                                <i class="fas fa-filter text-secondary"></i>
                            </button>
                            <div id="filtroTipo" class="filter-popup d-none">
                                <select class="form-control" onchange="filtrarPorColumna('tipo', this.value)">
                                    <option value="">Todos</option>
                                    <option value="ingreso">Ingreso</option>
                                    <option value="salida">Salida</option>
                                </select>
                            </div>
                        </th>
                        <th style="width: 12%; position: relative;">
                            Categoría
                            <button class="btn btn-sm filter-btn" onclick="mostrarFiltroPopup(event, 'filtroCategoria')" style="border: none;" data-column="categoria">
                                <i class="fas fa-filter text-secondary"></i>
                            </button>
                            <div id="filtroCategoria" class="filter-popup d-none">
                                <input type="text" class="form-control" placeholder="Buscar Categoría" onkeyup="filtrarPorColumna('categoria', this.value)">
                            </div>
                        </th>
                        <th style="width: 15%; position: relative;">
                            Detalles
                            <button class="btn btn-sm filter-btn" onclick="mostrarFiltroPopup(event, 'filtroDetalles')" style="border: none;" data-column="detalles">
                                <i class="fas fa-filter text-secondary"></i>
                            </button>
                            <div id="filtroDetalles" class="filter-popup d-none">
                                <input type="text" class="form-control" placeholder="Buscar Detalles" onkeyup="filtrarPorColumna('detalles', this.value)">
                            </div>
                        </th>
                        <th style="width: 8%; position: relative;">
                            Monto
                            <button class="btn btn-sm filter-btn" onclick="mostrarFiltroPopup(event, 'filtroMonto')" style="border: none;" data-column="monto">
                                <i class="fas fa-filter text-secondary"></i>
                            </button>
                            <div id="filtroMonto" class="filter-popup d-none">
                                <input type="text" class="form-control" placeholder="Buscar Monto" onkeyup="filtrarPorColumna('monto', this.value)">
                            </div>
                        </th>
                        <th style="width: 8%; position: relative;">
                            Moneda
                            <button class="btn btn-sm filter-btn" onclick="mostrarFiltroPopup(event, 'filtroMoneda')" style="border: none;" data-column="moneda">
                                <i class="fas fa-filter text-secondary"></i>
                            </button>
                            <div id="filtroMoneda" class="filter-popup d-none">
                                <select class="form-control" onchange="filtrarPorColumna('moneda', this.value)">
                                    <option value="">Todos</option>
                                    <option value="USD">USD</option>
                                    <option value="Pesos">Pesos</option>
                                </select>
                            </div>
                        </th>
                        <th style="width: 10%; position: relative;">
                            Patente
                            <button class="btn btn-sm filter-btn" onclick="mostrarFiltroPopup(event, 'filtroPatente')" style="border: none;" data-column="patente">
                                <i class="fas fa-filter text-secondary"></i>
                            </button>
                            <div id="filtroPatente" class="filter-popup d-none">
                                <input type="text" class="form-control" placeholder="Buscar Patente" onkeyup="filtrarPorColumna('patente', this.value)">
                            </div>
                        </th>
                        <th style="width: 13%; position: relative;">
                            Medio de Pago
                            <button class="btn btn-sm filter-btn" onclick="mostrarFiltroPopup(event, 'filtroMedioPago')" style="border: none;" data-column="medio_pago">
                                <i class="fas fa-filter text-secondary"></i>
                            </button>
                            <div id="filtroMedioPago" class="filter-popup d-none">
                                <input type="text" class="form-control" placeholder="Buscar Medio de Pago" onkeyup="filtrarPorColumna('medio_pago', this.value)">
                            </div>
                        </th>
                        <th style="width: 12%; position: relative;">
                            Comprobante
                            <button class="btn btn-sm filter-btn" onclick="mostrarFiltroPopup(event, 'filtroComprobante')" style="border: none;" data-column="comprobante">
                                <i class="fas fa-filter text-secondary"></i>
                            </button>
                            <div id="filtroComprobante" class="filter-popup d-none">
                                <input type="text" class="form-control" placeholder="Buscar Comprobante" onkeyup="filtrarPorColumna('comprobante', this.value)">
                            </div>
                        </th>
                        <th style="width: 15%;">
                            Acciones
                        </th>
                    </tr>
                </thead>
                
                
                <tbody>
                    {% for movimiento in movimientos %}
                    <tr>
                        <td>{{ movimiento.fecha|date:"j/n/Y"}}</td>
                        <td>
                            <span class="tipo-label {{ movimiento.tipo|lower }}">{{ movimiento.tipo }}</span>
                        </td>                        
                        <td>{{ movimiento.categoria.nombre }}</td>
                        <td>{{ movimiento.detalles }}</td>
                        <td>{{ movimiento.monto }}</td>
                        <td>{{ movimiento.moneda }}</td>
                        <td>{{ movimiento.patente }}</td>
                        <td>{{ movimiento.medio_pago.nombre }}</td>
                        <td>{{ movimiento.numero_comprobante }}</td>                 
                        <td class="text-center">
                            <a href="{% url 'finanzas:detalle_movimiento' movimiento.id %}" class="icon-view mx-1 no-underline">
                                <i class="fas fa-eye text-primary"></i>
                            </a>
                            <a href="#" class="icon-edit mx-1"><i class="fas fa-pencil-alt text-black"></i></a>
                            <a href="#" class="icon-delete mx-1"><i class="fas fa-trash-alt text-danger"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</body>
{% endblock %}
